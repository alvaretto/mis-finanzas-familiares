// ðŸ”’ REGLAS DE SEGURIDAD PARA FIRESTORE
// Copia estas reglas en Firebase Console > Firestore Database > Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ðŸ—ï¸ ESTRUCTURA PRINCIPAL DE LA APLICACIÃ“N
    // Ruta: artifacts/{appId}/shared_transactions/family_data
    match /artifacts/{appId}/shared_transactions/family_data/{document=**} {
      allow read, write: if request.auth != null;
    }

    // ðŸ‘¤ DATOS DE USUARIOS INDIVIDUALES
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // ðŸ“Š TRANSACCIONES PERSONALES - Solo el propietario puede acceder
      match /transactions/{transactionId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // ðŸ·ï¸ CATEGORÃAS PERSONALES - Solo el propietario puede acceder
      match /categories/{categoryId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // ðŸ’° ACTIVOS PERSONALES - Solo el propietario puede acceder
      match /assets/{assetId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // ðŸ’³ PASIVOS PERSONALES - Solo el propietario puede acceder
      match /liabilities/{liabilityId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // ðŸ’³ CUENTAS POR PAGAR PERSONALES - Solo el propietario puede acceder
      match /accounts_payable/{accountId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // ðŸ“‹ HISTORIAL DE PAGOS PERSONAL - Solo el propietario puede acceder
      match /payment_history/{paymentId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // âš™ï¸ CONFIGURACIONES PERSONALES - Solo el propietario puede acceder
      match /settings/{settingId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // ðŸ§  SISTEMA DE IA - Datos de memoria y aprendizaje
    match /artifacts/{appId}/ai_memory/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // âŒ DENEGAR TODO LO DEMÃS
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// ðŸ“ INSTRUCCIONES PARA APLICAR:
// 1. Ve a Firebase Console: https://console.firebase.google.com/
// 2. Selecciona tu proyecto: mis-finanzas-familiares-f7298
// 3. Ve a Firestore Database > Rules
// 4. Copia y pega las reglas de arriba
// 5. Haz clic en "Publicar"

// âœ… ESTAS REGLAS GARANTIZAN:
// - Solo usuarios autenticados pueden acceder a datos
// - Acceso compartido a datos familiares en artifacts/{appId}/shared_transactions/family_data
// - Datos personales protegidos por usuario individual
// - Cuentas por pagar y historial de pagos protegidos por usuario
// - Sistema de IA con datos protegidos por usuario
// - ProtecciÃ³n completa contra acceso no autorizado

// ðŸ†• NUEVAS FUNCIONALIDADES INCLUIDAS:
// - ðŸ’³ Cuentas por Pagar: GestiÃ³n completa de pagos recurrentes
// - ðŸ“‹ Historial de Pagos: Registro detallado de todos los pagos
// - ðŸ”„ Sistema de Recurrencia: Pagos automÃ¡ticos programados
// - ðŸ”” Alertas y Notificaciones: Recordatorios de vencimientos
// - ðŸ“Š AnÃ¡lisis Predictivo: Proyecciones de flujo de caja
// - ðŸ“± Optimizado para mÃ³viles Android
