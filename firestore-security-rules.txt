// 🔒 REGLAS DE SEGURIDAD PARA FIRESTORE
// Copia estas reglas en Firebase Console > Firestore Database > Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 🏗️ ESTRUCTURA PRINCIPAL DE LA APLICACIÓN
    // Ruta: artifacts/{appId}/shared_transactions/family_data
    match /artifacts/{appId}/shared_transactions/family_data/{document=**} {
      allow read, write: if request.auth != null;
    }

    // 👤 DATOS DE USUARIOS INDIVIDUALES
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // 📊 TRANSACCIONES PERSONALES - Solo el propietario puede acceder
      match /transactions/{transactionId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 🏷️ CATEGORÍAS PERSONALES - Solo el propietario puede acceder
      match /categories/{categoryId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 💰 ACTIVOS PERSONALES - Solo el propietario puede acceder
      match /assets/{assetId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 💳 PASIVOS PERSONALES - Solo el propietario puede acceder
      match /liabilities/{liabilityId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 💳 CUENTAS POR PAGAR PERSONALES - Solo el propietario puede acceder
      match /accounts_payable/{accountId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 📋 HISTORIAL DE PAGOS PERSONAL - Solo el propietario puede acceder
      match /payment_history/{paymentId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // ⚙️ CONFIGURACIONES PERSONALES - Solo el propietario puede acceder
      match /settings/{settingId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // 🧠 SISTEMA DE IA - Datos de memoria y aprendizaje
    match /artifacts/{appId}/ai_memory/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ❌ DENEGAR TODO LO DEMÁS
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// 📝 INSTRUCCIONES PARA APLICAR:
// 1. Ve a Firebase Console: https://console.firebase.google.com/
// 2. Selecciona tu proyecto: mis-finanzas-familiares-f7298
// 3. Ve a Firestore Database > Rules
// 4. Copia y pega las reglas de arriba
// 5. Haz clic en "Publicar"

// ✅ ESTAS REGLAS GARANTIZAN:
// - Solo usuarios autenticados pueden acceder a datos
// - Acceso compartido a datos familiares en artifacts/{appId}/shared_transactions/family_data
// - Datos personales protegidos por usuario individual
// - Cuentas por pagar y historial de pagos protegidos por usuario
// - Sistema de IA con datos protegidos por usuario
// - Protección completa contra acceso no autorizado

// 🆕 NUEVAS FUNCIONALIDADES INCLUIDAS:
// - 💳 Cuentas por Pagar: Gestión completa de pagos recurrentes
// - 📋 Historial de Pagos: Registro detallado de todos los pagos
// - 🔄 Sistema de Recurrencia: Pagos automáticos programados
// - 🔔 Alertas y Notificaciones: Recordatorios de vencimientos
// - 📊 Análisis Predictivo: Proyecciones de flujo de caja
// - 📱 Optimizado para móviles Android
